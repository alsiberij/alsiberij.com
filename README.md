# Интернет магазин фотографий [alsiberij.com](https://alsiberij.com)
___
## Описание веб-приложения

Данное приложение разрабатывалось в учебных целях с целью изучения паттернов "Маршрутизатор" и 
"MVC".

**Обработка запроса**
1. В файле `.htacess` настроена перезапись URL таким образом, что все запросы (кроме запросов файлов) обрабатываются
`index.php`.
2. В `index.php` производятся инициализация глобальных констант, настройка автозагрузки
классов, а также, в случае успешного запуска сессии, создается объект маршрутизатора типа `Router`, в конструкторе
которого подгружается таблица маршрутизации.
3. На объекте маршрутизатора вызывается метод `run(): void`, в котором из исходного URI извлекается только 
необходимая для маршрутизации часть. После того как был получен новый URI, производится поиск совпадений 
в таблице маршрутизации. В случае успеха, мы получаем название контроллера, который
будет обрабатывать запрос, название метода, который будет заниматься обработкой конкретных страниц,
и параметры маршрута. В случае неудачи пользователю будет показана страница с ошибкой 404.
4. Когда было получено имя контроллера, производится обращение к фабрике, возвращающей
объект типа `Controller`. На полученном объекте вызывается реализованный метод `action(string $name): bool`,
в который передается имя обработчика страницы. Данный метод вернет `true`, если в процессе
работы контроллера не возникло никаких ошибок, в противно случае - `false`.

**Контроллеры и обработчики**

| Контроллер | Область | Обработчики |
|:---:|:---|:---|
| `BaseController` |`/` |`Index` - `/`|
| `NewsController` | `/news` |`Index` - `/`<br>`Show` - `/5`<br>`Add` - `/add` |
| `AccountController` | `/account` |`Index` - `/`<br>`Show` - `/5`<br>`Manage` - `/5/manage`<br>`LogIn` - `/login`<br>`SignUp` - `/signup`<br>`LogOut` - `/logout`<br>`Activate` - `/activate`|
| `StoreController` | `/store` |`Index` - `/`<br>`ShowCategory` - `/portrait`<br>`ShowPhoto` - `/portrait/5`<br>`AddCategory` - `/add/category`<br>`AddPhoto` - `/add/photo`<br>`Buy` - `/buy`<br>`Download` - `/download` |
| `ApiController` | `/api` | `Respond` - `/`|

**Сущности**
- `Entity` 
    - Абстрактная сущность. Конкретная сущность, которая будет наследоваться от этого класса,
будет однозначно определяться именем ее класса (таблицей в БД) и уникальным идентификатором (первичным ключом).
Такой подход позволит реализовать схему, при которой конкретный объект конкретной сущности будет
создан только один раз, а далее везде будет использоваться только ссылка на него. Такая экономия ресурсов весьма
целесообразна, поскольку избавляет нас от необходимости создавать одну и ту же сущность много раз. _Пример_: В объекте класса `News` хранится ссылка на объект автора класса `User`. В случае, если мы формируем список
  всех новостей, автором которого является один и тот же человек, то пришлось бы каждый раз создавать одну и ту же
  сущность для каждой новости. Но поскольку конструктом у нас является метод `newInstance(int $ID): ?Entity`, который
  сначала проверяет, есть ли уже созданный объект с таким идентификатором, то мы можем быть
  уверены, что ресурсы сервера не будут использоваться в пустую и мы всегда будем получать ссылку на один и тот же объект.
- `LikableEntity extends Entity`
    - Абстрактная сущность, который может быть поставлен лайк.
- `CommentableViewableEntity extend LikebaleEntity`
    - Абстрактная сущность со счетчиком просмотров и возможностью оставить комментарий.
- `User extends Entity`
    - Класс для сущности "Пользователь"
- `News extends Entity`
    - Класс для сущности "Новость".
- `Photo extends Entity`
    - Класс для сущности "Фотография
- `CategoryPhoto extends Entity`
    - Класс для сущности "Категория фотографии"
- `DownloadLink extends Entity`
    - Класс для сущности "Ссылка для скачивания".
- `AbstractComment` Абстрактный класс для комментария. Поскольку комментарий под новостью и комментарий под фото
это разные сущности, то представлять их будут два разных класса. Целесообразно вынести общую логику 
в отдельный абстрактный класс.
- `CommentNews`
    - Класс для сущности "Комментарий под новостью"
- `CommentPhoto`
    - Класс для сущности "Комментарий под фото"

...

Документ будет дополняться по мере разработки.

----
Первостепенной задачей является разработка полноценного REST API на основе уже реализованной логики в сущностях на поддомене
api.alsiberij.com











